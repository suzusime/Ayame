構文解析仕様
===========
この文書は文目言語の構文解析に関する仕様書です。

文法要素は `{行}` のように波括弧で、トークンは[字句解析仕様](字句解析仕様.md)で示されたトークン表記に従って表記します。
`ε` は「空」を表します。

## スクリプト
```
{スクリプト} ::= ( {行} <LF> )* 
```

スクリプトは0以上の行により構成されます。

## 行
```
{行} ::= {式}
       | {式} <t> {式}
       | <t> {式}
       | # {文字列}
       | ε
```

行は次の5つの形式のどれかをとります。

1つめは、式1つで構成される形式です。
これは、式の評価結果が地の文として表示される記法です。

2つめは、2つの式がタブに区切られて並んでいる形式です。
これは、1つめの式の評価結果が発話者名、2つめの式の評価結果が台詞として表示される記法です。

3つめは、最初にタブがあったあとに式が続く形式です。
この場合、発話者名は前の発話者名と同じものとなり、式の評価結果が台詞として表示されます。
但し、発話者名は改ページ（空行）を挟むとリセットされ、空白となります。
つまり、空行の後にこのような記法の行を書くと、それは地の文となります。

4つめは、#のあとに文字列が続く形式です。
これはその文字列を名前としたラベルを定義する記法です。

5つめは、空行です。
空行は改ページを意味します。

#### 例1
```
俺はこいつの何を知っている？何も知らないじゃないか。
```
これは地の文です。

#### 例2
```
七瀬	そんな悲しいこと言わないでください。
	$heroさんらしくないです。

	でも……
	お前はああ言ったじゃないか。

	ほら、――
```
これは、
1. 「そんな～らしくないです。」までが七瀬の台詞として表示され、
2. 改ページを挟み、
3. 「でも～じゃないか。」までが地の文として表示され、
4. 改ページを挟み、
5. 「ほら、――」が地の文として表示される。

スクリプトになります。

#### 例3
```
#happyend
```
これは `happyend` というラベルを定義する行になります。

## 式
```
{式} ::= ( {文字列} | {函数} | <d> )+
```
式は、文字列または函数または区切りを1つ以上並べたものとなります。

区切りは表示されません。

#### 例1
```
俺の名前は[type]だ。
```
`[type]`函数の評価結果が`越前`だった場合、 `俺の名前は越前だ。` と表示されます。


#### 例2
```
This is a pen.
```
のトークン表記は
```
"This" <d> "is" <d> "a" <d> "pen."
```
であり、区切りは表示されないので、これは`Thisisapen.`と表示されます。

これを回避するためには、エスケープ記法（未実装）によって半角空白をリテラルの一部として扱わせる必要があります。


## 文字列
```
{文字列} ::= "リテラル"
           | $variable
```
文字列はリテラルまたは変数によって構成されます。

## 函数
```
{函数} ::= [ {函数} | {文字列} ( <d> {函数} | {文字列} )* ]
```

函数は `[]` に囲まれ、区切りによって区切られた1つ以上の函数または文字列から成ります。

#### 例1
```
[cwait]
```
これは `cwait` という名の函数を呼び出す表記です。

#### 例2
```
[if $is_A Aです Aじゃないです]
```
これは `if` という函数を 第1引数 `$is_A` 、第2引数 `Aです` 第3引数 `Aじゃないです` として呼び出す表記です。

#### 例3
```
[$funcname [get hoge]]
```
このように函数名を変数にしたり、函数名や引数として函数を用いる入れ子なども許容されます。

注意：現状の仕様では、開き角括弧の直後や閉じ角括弧の直前に区切り文字が入ることは許容されていません。

